generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  email        String        @unique
  fullName     String
  passwordHash String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  categories   Category[]
  transactions Transaction[]
  budgets      Budget[]
  stocks       Stock[]
}

model Stock {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  symbol      String   // E.g., AAPL, TSLA, RELIANCE
  name        String   // E.g., Apple Inc.
  quantity    Float
  buyPrice    Float    // Average buying price
  sellPrice   Float?   // Last selling price (if applicable)
  currentPrice Float?  // Current market price (for valuation)
  type        String   // BUY, SELL
  totalValue  Float?   // Derived or stored: quantity * bugPrice/currentPrice
  userId      String   @db.ObjectId
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
}

model Category {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  categoryGroup String // Income, Expense, Investment
  isDefault     Boolean       @default(false)
  userId        String        @db.ObjectId
  user          User          @relation(fields: [userId], references: [id])
  transactions  Transaction[]
  budgets       Budget[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@unique([userId, name, categoryGroup])
}

model Transaction {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  type          String // income, expense, investment
  amount        Float
  date          DateTime
  notes         String?
  categoryGroup String
  category      String
  subCategory   String?
  status        String   @default("active") // active, terminated (for FD/Bonds)
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id])
  categoryId    String?  @db.ObjectId
  categoryRel   Category? @relation(fields: [categoryId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId, date])
}

model Budget {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  amount     Float
  month      String // Format: YYYY-MM
  categoryId String   @db.ObjectId
  category   Category @relation(fields: [categoryId], references: [id])
  userId     String   @db.ObjectId
  user       User     @relation(fields: [userId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([userId, categoryId, month])
}

model ActivityLog {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  action      String   // transaction_added, transaction_updated, transaction_deleted, investment_terminated, budget_set, etc.
  description String   // Human-readable description
  icon        String?  // Icon type: success, warning, info, error
  metadata    Json?    // Extra details (amount, category, transactionId, etc.)
  createdAt   DateTime @default(now())

  @@index([userId, createdAt])
}
